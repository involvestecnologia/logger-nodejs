steps:
  - label: "Tests"
    key: "test"
    command:
      - npm install --no-audit
      - npm test
    agents:
      queue: "node14"

  - label: "Publish Library"
    key: "publish"
    command:
      - "npm version patch"
      - "git push origin HEAD:master --force --signed"
      - "git push origin HEAD:master --force --signed --tags"
    agents:
      queue: "node14"
    depends_on:
      - "test"
    if: build.branch == "master"